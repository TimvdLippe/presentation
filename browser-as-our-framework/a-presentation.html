<link rel="import" href="bower_components/iron-pages/iron-pages.html" />
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html" />
<link rel="import" href="bower_components/iron-icons/iron-icons.html" />
<link rel="import" href="bower_components/prism-element/prism-highlighter.html" />
<link rel="import" href="bower_components/prism-element/prism-theme-default.html" />
<link rel="import" href="bower_components/marked-element/marked-element.html" />
<link rel="import" href="bower_components/iron-ajax/iron-ajax.html" />
<link rel="import" href="a-slide.html" />
<link rel="import" href="website-timers.html" />
<link rel="import" href="website-timer.html" />

<dom-module id="a-presentation">
  <template>
    <style include="prism-theme-default"></style>
    <style>
      a-slide {
        background-color: #4285ff;
        color: white;
        width: 100%;
        height: 100%;
      }

      a-slide.white {
        background-color: white;
        color: black;
      }

      img {
        display: block;
      }

      .circle {
        border-radius: 50%;
        width: 250px;
      }

      paper-icon-button {
        position: absolute;
        bottom: 2vh;
      }

      paper-icon-button.forward {
        right: 5vw;
      }
      paper-icon-button.back {
        right: calc(7vw + 24px);
      }

      marked-element {
        margin-top: 25px;
        overflow: auto;
        max-height: 50vh;
      }

      marked-element.code {
        width: 80vw;
        max-height: 80vh;
        font-size: 1.5em;
      }

      svg {
        width: 80vw;
        margin: 0 auto;
        height: 200px;
      }

      .flex {
        display: flex;
      }

      .flex > * {
        flex: 1;
        max-width: 50vw;
      }

      .flex img.half {
        max-width: 100%;
        max-height: 100%;
      }

      .medium {
        font-size: calc(16px + 2vw);
        font-weight: lighter;
        margin-left: 40px;
      }

      .list li {
        list-style: none;
      }

      .list img {
        width: 80px;
        vertical-align: middle;
        display: inline-block;
      }
    </style>

    <prism-highlighter></prism-highlighter>

    <iron-pages id="pages" on-selected-changed="_updateHash">
      <a-slide>
        <span>The browser as our framework</span>
      </a-slide>
      <a-slide>
        <img class="circle" src="https://lh3.googleusercontent.com/BBxQgDdGpeIBMgvEleX7J2W_FEzRlYEg4JM6y-mQumBQhR4AOldW5Czyx33gA8xgHY86tl7HcA=w1920-h1080-rw-no" />
        <span>Tim van der Lippe</span>
        <span>Google Developer Expert + <br /> master student CS TU Delft</span>
      </a-slide>
      <a-slide>
        <img src="https://wisv.ch/assets/logo.png" />
        <span></span>
        <span>Computer Science + Mathematics</span>
        <ul>
          <li>
            3500 members
          </li>
          <li>
            37 committees
          </li>
          <li>
            22 committees with 1+ website
          </li>
        </ul>
      </a-slide>
      <a-slide>
        <span>Committees</span>
        <span>6 members</span>
        <span>50% Computer Science</span>
        <span>50% Mathematics</span>
      </a-slide>
      <a-slide>
        <span>Website developers</span>
        <span>Usually 1 to 2 members</span>
        <span>Limited timeframe (couple of weeks)</span>
      </a-slide>
      <a-slide>
        <span>Technology choice</span>
        <ul>
          <li>
            Experience with technology
          </li>
          <li>
            Fancy
          </li>
        </ul>
      </a-slide>
      <a-slide>
        <span></span>
        <ul>
          <li>
            Express
          </li>
          <li>
            Polymer
          </li>
          <li>
            PHP + Bootstrap
          </li>
          <li>
            PHP + jQuery
          </li>
          <li>
            Wordpress + jQuery
          </li>
          <li>
            Angular + jQuery
          </li>
          <li>
            Etc...
          </li>
        </ul>
      </a-slide>
      <a-slide>
        <span>jQuery</span>
        <ul>
          <li>
            Minimal
          </li>
          <li>
            Easy to grasp
          </li>
          <li>
            Now outdated
          </li>
        </ul>
      </a-slide>
      <a-slide>
        <span>Observed problems</span>
        <ul>
          <li>
            Non-performant
          </li>
          <li>
            Buggy
          </li>
          <li>
            Maintenance time-consuming
          </li>
          <li>
            Computer Science only
          </li>
        </ul>
      </a-slide>
      <a-slide class="white">
        <span>Custom Elements vision</span>
        <a href="https://github.com/WISVCH/committee-website-vision" target="_blank">https://github.com/WISVCH/committee-website-vision</a>
        <iron-ajax
          url="https://raw.githubusercontent.com/WISVCH/committee-website-vision/master/README.md"
          handle-as="text"
          last-response="{{vision}}"
        ></iron-ajax>
        <marked-element markdown="[[vision]]"></marked-element>
      </a-slide>
      <a-slide>
        <span>Custom elements vision</span>
        <span>Important: analyze use case</span>
        <span>Discuss with stakeholders:</span>
        <ul>
          <li>
            Board
          </li>
          <li>
            Frequent committee members
          </li>
          <li>
            Mathematics students
          </li>
        </ul>
      </a-slide>
      <a-slide>
        <span>"Custom elements are slow!"</span>
        <span>- Older CH member</span>
      </a-slide>
      <a-slide>
        <span></span>
        <a href="https://areafiftylan.nl">https://areafiftylan.nl</a>
        <website-timers>
          <website-timer url="https://areafiftylan.firebaseapp.com/"></website-timer>
        </website-timers>
      </a-slide>
      <a-slide>
        <span>Perceived slowness</span>
        <span>Content is not prioritized</span>
        <span>Waiting for almost full page load</span>
      </a-slide>
      <a-slide class="white">
        <span></span>
        <span>index.html</span>
        <iron-ajax
          url="./index-scaffold.md"
          handle-as="text"
          last-response="{{indexBoilerPlate}}"
        ></iron-ajax>
        <marked-element class="code" markdown="[[indexBoilerPlate]]">
          <div slot="markdown-html"></div>
        </marked-element>
      </a-slide>
      <a-slide class="white">
        <span></span>
        <span>&lt;lancie-app&gt;</span>
        <iron-ajax
          url="./my-app-scaffold.md"
          handle-as="text"
          last-response="{{myAppBoilerPlate}}"
        ></iron-ajax>
        <marked-element class="code" markdown="[[myAppBoilerPlate]]">
          <div slot="markdown-html"></div>
        </marked-element>
      </a-slide>
      <a-slide>
        <span>PRPL pattern</span>
      </a-slide>
      <a-slide>
        <svg viewBox="-15 -15 1250 250" preserveAspectRatio="xMidYMid meet">
          <g>
            <circle x="0" y="0" cx="100" cy="100" r="100" fill="none" stroke="white" stroke-width="2" />
            <text x="45" y="110" font-family="Roboto" font-size="25" fill="white">index.html</text>
          </g>

          <line stroke="white" stroke-width="2" x1="200" y1="100" x2="250" y2="100"></line>

          <g transform="translate(250, 0)">
            <circle x="0" y="0" cx="100" cy="100" r="100" fill="none" stroke="white" stroke-width="2" />
            <text x="60" y="110" font-family="Roboto" font-size="25" fill="white">my-app</text>
          </g>

          <line stroke="white" stroke-width="2" x1="450" y1="100" x2="500" y2="100"></line>

          <g transform="translate(500, 0)">
            <circle x="0" y="0" cx="100" cy="100" r="100" fill="none" stroke="white" stroke-width="2" />
            <text x="35" y="110" font-family="Roboto" font-size="25" fill="white">app skeleton</text>
          </g>

          <line stroke="white" stroke-width="2" x1="700" y1="100" x2="750" y2="100"></line>

          <g transform="translate(750, 0)">
            <circle x="0" y="0" cx="100" cy="100" r="100" fill="none" stroke="white" stroke-width="2" />
            <text x="50" y="110" font-family="Roboto" font-size="25" fill="white">lazy load</text>
          </g>

          <line stroke="white" stroke-width="2" x1="950" y1="100" x2="1000" y2="100"></line>

          <g transform="translate(1000, 0)">
            <circle x="0" y="0" cx="100" cy="100" r="100" fill="none" stroke="white" stroke-width="2" />
            <text x="30" y="110" font-family="Roboto" font-size="25" fill="white">show content</text>
          </g>
        </svg>
      </a-slide>
      <a-slide>
        <span></span>
        <span>3G load time</span>
        <img src="areafiftylan-load.png" />
      </a-slide>
      <a-slide>
        <svg viewBox="-15 -15 1250 250" preserveAspectRatio="xMidYMid meet">
          <g>
            <circle x="0" y="0" cx="100" cy="100" r="100" fill="none" stroke="white" stroke-width="2" />
            <text x="45" y="110" font-family="Roboto" font-size="25" fill="white">index.html</text>
          </g>

          <line stroke="white" stroke-width="2" x1="200" y1="100" x2="250" y2="100"></line>

          <g transform="translate(250, 0)">
            <circle x="0" y="0" cx="100" cy="100" r="100" fill="none" stroke="white" stroke-width="2" />
            <text x="60" y="110" font-family="Roboto" font-size="25" fill="white">my-app</text>
          </g>

          <line stroke="white" stroke-width="2" x1="450" y1="100" x2="500" y2="100"></line>

          <g transform="translate(500, 0)">
            <circle x="0" y="0" cx="100" cy="100" r="100" fill="none" stroke="white" stroke-width="2" />
            <text x="35" y="110" font-family="Roboto" font-size="25" fill="white">app skeleton</text>
          </g>

          <line stroke="white" stroke-width="2" x1="700" y1="100" x2="750" y2="100"></line>

          <g transform="translate(750, 0)">
            <circle x="0" y="0" cx="100" cy="100" r="100" fill="none" stroke="white" stroke-width="2" />
            <text x="50" y="110" font-family="Roboto" font-size="25" fill="white">lazy load</text>
          </g>

          <line stroke="white" stroke-width="2" x1="950" y1="100" x2="1000" y2="100"></line>

          <g transform="translate(1000, 0)">
            <circle x="0" y="0" cx="100" cy="100" r="100" fill="none" stroke="white" stroke-width="2" />
            <text x="30" y="110" font-family="Roboto" font-size="25" fill="white">show content</text>
          </g>
        </svg>
      </a-slide>
      <a-slide>
        <span></span>
        <span>Speed comparison</span>
        <website-timers>
          <website-timer url="https://sympo-old-14d37.firebaseapp.com/#/"></website-timer>
          <website-timer url="https://sympo-new.firebaseapp.com/2017/"></website-timer>
        </website-timers>
      </a-slide>
      <a-slide>
        <span></span>
        <span>Progressive loading</span>
        <img src="symposium-load.png" />
      </a-slide>
      <a-slide class="white">
        <span></span>
        <span>50 lines script</span>
        <iron-ajax
          url="./analyzer.md"
          handle-as="text"
          last-response="{{analyzer}}"
        ></iron-ajax>
        <marked-element class="code" markdown="[[analyzer]]">
          <div slot="markdown-html"></div>
        </marked-element>
      </a-slide>
      <a-slide>
        <span></span>
        <ul>
          <li>
            Read index.html
          </li>
          <li>
            Analyze selector for sub-pages
          </li>
          <li>
            Read template with Analyzer
          </li>
          <li>
            Modify AST with parse5
          </li>
          <li>
            Write to disk
          </li>
        </ul>
      </a-slide>
      <a-slide class="white">
        <span></span>
        <span>Scaffolded ticket-page</span>
        <iron-ajax
          url="./scaffold.md"
          handle-as="text"
          last-response="{{scaffold}}"
        ></iron-ajax>
        <marked-element class="code" markdown="[[scaffold]]">
          <div slot="markdown-html"></div>
        </marked-element>
      </a-slide>
      <a-slide class="white">
        <span></span>
        <span>NGINX config (inside Docker)</span>
        <iron-ajax
          url="./nginx.md"
          handle-as="text"
          last-response="{{nginx}}"
        ></iron-ajax>
        <marked-element class="code" markdown="[[nginx]]">
          <div slot="markdown-html"></div>
        </marked-element>
      </a-slide>
      <a-slide>
        <span></span>
        <span>LightHouse score</span>
        <div class="flex">
          <div>
            <img class="half" src="https://pbs.twimg.com/media/C6fS8DrWAAArday.jpg"/>
          </div>
          <div>
            <img src="https://cloud.githubusercontent.com/assets/39191/22478294/23f662f6-e79e-11e6-8de3-ffd7be7bf628.png" width="200px" />
            <a href="https://github.com/GoogleChrome/lighthouse">https://github.com/GoogleChrome/lighthouse</a>
            <ul class="medium">
              <li>
                Lighthouse <a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk">extension</a>
              </li>
              <li>
                Assesses your website
              </li>
              <li>
                No JS response impossible with &lt;my-app&gt;
              </li>
            </ul>
          </div>
        </div>
      </a-slide>
      <a-slide class="white">
        <span>Contact information</span>
        <ul class="list">
          <li><img src="https://www.google.com/images/icons/product/googlemail-128.png"/>: tvanderlippe</a></li>
          <li><img src="https://twittercommunity.com/uploads/default/1339/b5c34a09eb5dbbac.png" />: TimvdLippe</li>
          <li><img src="https://assets-cdn.github.com/images/modules/logos_page/GitHub-Mark.png" />: TimvdLippe</a></li>
        </ul>
      </a-slide>
    </iron-pages>
    <paper-icon-button class="back" icon="icons:arrow-back" on-tap="previous"></paper-icon-button>
    <paper-icon-button class="forward" icon="icons:arrow-forward" on-tap="next"></paper-icon-button>
  </template>
  <script>
    Polymer({
      is: 'a-presentation',

      hostAttributes: {
        'tabindex': 0
      },

      attached: function() {
        this.focus();

        this._maxSlides = this.$.pages.children.length - 1;

        var nexts = [39 /* right */, 40 /* down */, 32 /* space */, 13 /* enter */];
        var backs = [37 /* left */, 38 /* up */];
        this.addEventListener('keydown', function(event) {
          if (nexts.indexOf(event.keyCode) !== -1 ) {
            this.next();
          } else if (backs.indexOf(event.keyCode) !== -1) {
            if (!event.altKey) {
              this.previous();
            }
          } else if ((event.charChode == '32')) {  // Ok Firefox.
            this.next();
          }
        }, true);
        window.addEventListener('hashchange', this.selectIndexFromHash.bind(this));
        this.selectIndexFromHash();

        var ajaxes = Polymer.dom(this.root).querySelectorAll('iron-ajax');
        for (var i = 0; i < ajaxes.length; i++) {
          ajaxes[i].generateRequest();
        }
      },

      next: function() {
        if (this._maxSlides !== this.$.pages.selected) {
          this.$.pages.selectNext();
        }
      },

      previous: function() {
        if (this.$.pages.selected > 0) {
          this.$.pages.selectPrevious();
        }
      },

      selectIndexFromHash: function() {
        var index = parseInt(window.location.hash.replace('#', '') || 0);
        this.$.pages.select(Math.min(index, this._maxSlides));
      },

      _updateHash: function(e) {
        window.location.hash = e.detail.value;
      }
    });
  </script>
</dom-module>
